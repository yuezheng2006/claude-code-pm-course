# 实时合唱功能规格(草稿)

## 概述
在SingTech K歌APP中添加实时合唱功能,允许多个用户同时在线合唱同一首歌,实现真正的多人K歌体验。

## 目标
- 允许 2-6 个用户同时在线合唱同一首歌
- 实时同步歌词进度和演唱状态
- 显示其他合唱者的头像和演唱状态
- 支持音频实时混音和同步
- 在移动端(iOS/Android)和家庭点歌机上都能工作

## 用户故事
- 作为K歌爱好者,我想和朋友一起在线合唱,即使我们不在同一个地方
- 作为用户,我想看到其他合唱者的演唱状态(正在唱、暂停、已完成),这样我知道何时轮到我
- 作为房间创建者,我想控制合唱的开始和暂停,确保所有人同步
- 作为合唱者,我想听到所有人的声音混合在一起,就像在KTV包房一样

## 技术方法
- 使用 WebRTC 进行实时音频传输
- WebSocket 用于歌词同步、状态同步(播放/暂停、进度)
- 服务器端音频混音(将多个音频流混合成单一输出)
- 显示合唱者头像、演唱状态指示器(谁在唱、谁在等待)
- 歌词进度同步(确保所有人看到同一句歌词)

## 成功指标
- 音频延迟低于 200ms(从演唱到其他用户听到)
- 歌词同步误差小于 500ms
- 支持至少 6 个并发合唱者
- 房间创建成功率 >95%
- 平均合唱完成率 >70%(开始合唱的用户完成整首歌)

## 时间线
- 第 1 阶段: 基础房间功能(创建房间、邀请、加入)(2 周)
- 第 2 阶段: 歌词同步和状态显示(3 周)
- 第 3 阶段: 实时音频传输和混音(4 周)
- 第 4 阶段: 移动端优化和家庭点歌机适配(3 周)

## 开放问题
- 我们如何处理网络连接不佳的用户?(音频质量降级策略)
- 如果某个用户断线,房间如何处理?(自动暂停 vs 继续)
- 我们需要房间录制功能吗?(保存合唱作品)
- 如何处理不同用户的音质差异?(AI修音是否应用到实时合唱)
- 房间人数上限是多少?(技术限制 vs 体验限制)

## 所需资源
- 2 名后端工程师(WebRTC服务器、音频混音服务)
- 2 名前端工程师(移动端UI和实时同步逻辑)
- 1 名音频工程师(音频处理、混音算法优化)
- 1 名移动工程师(iOS/Android原生音频处理)
- QA 支持用于测试网络边缘情况(弱网、断线重连)
